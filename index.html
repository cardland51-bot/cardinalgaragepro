<!DOCTY<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1,user-scalable=no" />
<title>HERO PRO ‚Ä¢ JARED ‚Ä¢ Upload ‚Üí Estimate ‚Üí Send</title>
<meta name="theme-color" content="#0b1b16" />
<style>
  :root{
    --bg-top:#0b1b16; --bg-bot:#06121a;
    --mintL:#9CFFE0; --mint:#34D1A0; --aqua:#2FB0E9; --teal:#0E8B67;
    --text:#E9FFF6; --textDim:rgba(233,255,246,.85);
    --glass:rgba(255,255,255,0.05); --stroke:rgba(156,255,224,0.28);
  }
  html,body{margin:0;height:100%;background:linear-gradient(180deg,var(--bg-top),var(--bg-bot));color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  *{box-sizing:border-box}

  body::before, body::after{
    content:""; position:fixed; inset:0; pointer-events:none;
  }
  body::before{
    background:
      radial-gradient(130% 90% at 50% 6%, rgba(156,255,224,.10), transparent 45%),
      radial-gradient(120% 80% at 50% 95%, rgba(47,176,233,.12), transparent 55%);
    animation:film1 14s ease-in-out infinite alternate;
  }
  body::after{
    background:
      linear-gradient( to right, transparent 0%, rgba(156,255,224,.05) 30%, transparent 60%),
      linear-gradient( to left, transparent 0%, rgba(47,176,233,.05) 30%, transparent 60%);
    mix-blend-mode:screen;
    animation:film2 18s linear infinite;
  }
  @keyframes film1{to{transform:translateY(-2%)}}
  @keyframes film2{to{transform:translateX(-2%)}}

  .topleft,.topright{position:fixed;top:12px;z-index:20}
  .topleft{left:12px}
  .topright{right:12px;display:flex;gap:8px}
  .pill{border:1px solid var(--stroke);background:rgba(255,255,255,.05);color:var(--mintL);
        padding:.5rem .75rem;border-radius:999px;backdrop-filter:blur(6px);cursor:pointer;
        display:flex;align-items:center;gap:.5rem;font-size:12px;box-shadow:0 0 12px rgba(156,255,224,.18)}
  .iconbtn{width:42px;height:42px;border-radius:50%;border:1px solid var(--stroke);
           background:rgba(255,255,255,.05);display:grid;place-items:center;cursor:pointer;
           box-shadow:0 0 12px rgba(156,255,224,.14)}

  .topbar{position:fixed;inset:0 0 auto 0;height:64px;display:grid;place-items:center;pointer-events:none}
  .brand{pointer-events:auto;font-weight:900;letter-spacing:.08em}
  .brand .hero{font-weight:900;color:var(--mintL)}
  .brand .pro{font-weight:500;color:var(--text);opacity:.9;margin-left:.2ch}

  .stage{position:fixed;inset:64px 0 148px 0;display:grid;place-items:center;padding:18px}
  .stack{display:flex;flex-direction:column;align-items:center;text-align:center;gap:12px;max-width:960px;width:100%}

  .btn{appearance:none;border:1px solid var(--mint);background:var(--glass);color:var(--mintL);
    padding:.85rem 1.4rem;border-radius:999px;letter-spacing:.08em;text-transform:uppercase;
    font-weight:700;backdrop-filter:blur(6px);cursor:pointer;transition:box-shadow .2s,transform .1s;
    box-shadow:0 0 16px rgba(156,255,224,.14);font-size:13px;position:relative;overflow:hidden}
  .btn:hover{box-shadow:0 0 26px rgba(156,255,224,.45),0 0 24px rgba(47,176,233,.25)}
  .btn:active{transform:translateY(1px)}
  .btn.hidden{display:none}
  .btn-row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}

  #preview{display:none;position:relative;width:min(94vw,960px);aspect-ratio:16/10;border-radius:16px;overflow:hidden;border:1px solid var(--stroke);box-shadow:0 0 24px rgba(156,255,224,.14)}
  #preview img,#preview video{width:100%;height:100%;object-fit:cover}
  #edgeGlow{position:absolute;inset:0;border-radius:16px;pointer-events:none;opacity:0;
    box-shadow:0 0 28px rgba(156,255,224,.6),inset 0 0 18px rgba(14,139,103,.55);transition:opacity .25s}
  .glow-on #edgeGlow{opacity:1}
  .wheel{position:absolute;inset:auto auto 10px 10px;background:rgba(0,0,0,.35);border:1px solid var(--stroke);
    border-radius:999px;padding:.35rem .6rem;font-size:12px;display:flex;gap:.5rem;align-items:center}
  .mini-spin{width:14px;height:14px;border-radius:50%;border:2px solid rgba(156,255,224,.35);border-top-color:var(--mintL);animation:spin 1s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}

  .tips{position:fixed;top:14%;left:0;right:0;pointer-events:none}
  .tip{position:absolute;max-width:340px;background:rgba(255,255,255,.06);border:1px solid var(--stroke);
    backdrop-filter:blur(8px);color:var(--text);padding:.7rem .9rem;border-radius:12px;
    box-shadow:0 0 18px rgba(156,255,224,.25);opacity:0;transform:translateX(-40px);
    transition:transform .6s cubic-bezier(.2,.9,.2,1),opacity .6s}
  .tip.right{right:16px;left:auto;transform:translateX(40px)}
  .tip.show{opacity:1;transform:translateX(0)}

  .hud{display:none;gap:8px;margin-top:10px;flex-wrap:wrap;justify-content:center}
  .tab{padding:.45rem .8rem;border:1px solid var(--stroke);border-radius:999px;background:rgba(255,255,255,.04);color:var(--textDim);font-size:12px}

  .mic-dock{position:fixed;left:50%;bottom:88px;transform:translateX(-50%);z-index:25}
  .mic{width:68px;height:68px;border-radius:50%;border:1px solid var(--mint);
    background:linear-gradient(180deg,rgba(156,255,224,.07),rgba(47,176,233,.06));
    display:grid;place-items:center;cursor:grab;box-shadow:0 0 16px rgba(156,255,224,.2)}
  .mic:active{cursor:grabbing}
  .mic .ring{width:42px;height:42px;border:3px solid var(--mint);border-radius:50%}
  .mic.idle .ring{box-shadow:0 0 10px rgba(156,255,224,.25)}
  .mic.listening .ring{animation:breathe 1.2s ease-in-out infinite;box-shadow:0 0 14px rgba(156,255,224,.45)}
  .mic.processing .ring{animation:slowpulse 1.6s ease-in-out infinite;border-color:var(--aqua)}
  .mic.speaking .ring{box-shadow:0 0 18px rgba(47,176,233,.55),0 0 28px rgba(156,255,224,.35)}
  @keyframes breathe{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
  @keyframes slowpulse{0%,100%{transform:scale(1)}50%{transform:scale(1.04)}}
  .mic-note{margin-top:6px;text-align:center;font-size:12px;color:var(--textDim);user-select:none}

  .footer{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;font-size:12px;color:rgba(233,255,246,.6);letter-spacing:.12em;text-transform:uppercase}
  .garage{position:fixed;right:14px;bottom:46px;background:rgba(255,255,255,.05);border:1px solid var(--stroke);
    border-radius:12px;padding:.45rem .65rem;display:flex;align-items:center;gap:.45rem;cursor:pointer;
    box-shadow:0 0 12px rgba(156,255,224,.18);font-size:12px;z-index:15}
  .garage.locked{opacity:.65}

  .overlay{display:none;position:fixed;inset:0;background:rgba(3,8,6,.82);backdrop-filter:blur(6px);align-items:center;justify-content:center;z-index:60}
  .panel{max-width:540px;margin:20px;background:rgba(255,255,255,.06);border:1px solid var(--stroke);
    border-radius:16px;padding:1.1rem 1.3rem;text-align:center;box-shadow:0 0 32px rgba(156,255,224,.28)}
</style>
</head>
<body>

<div class="topbar">
  <div class="brand"><span class="hero">HERO</span><span class="pro">PRO</span></div>
</div>

<div class="stage">
  <div class="stack">
    <div class="module primary-row">
      <button class="btn" id="btnUpload">‚¨Ü Upload Photo</button>
      <button class="btn" id="btnCamera">üì∑ Camera</button>
      <button class="btn" id="btnEstimate">üîç Estimate</button>
      <button class="btn hidden" id="btnExport">üì§ Export Estimate & Sales Insight</button>
    </div>
    <div id="preview">
      <img id="previewImg" alt="preview" />
      <div id="edgeGlow"></div>
      <div class="wheel" id="wheel" style="display:none;"><div class="mini-spin"></div><span id="wheelText">Analyzing‚Ä¶</span></div>
      <div class="dash-hint" id="dashHint" style="position:absolute;inset:0;opacity:.0;pointer-events:none;"></div>
    </div>
    <div class="mic-dock" id="micDock"><div class="mic idle" id="mic"><div class="ring"></div></div><div class="mic-note" id="micLabel">Tap to Talk ‚Äî Tap again to Send</div></div>
    <div class="hud" id="hudTabs"><div class="tab">Workflow</div><div class="tab">Insights</div><div class="tab">Join Our Journey</div><div class="tab">Sales University</div></div>
    <input type="file" id="file" accept="image/*" hidden />
  </div>
</div>

<div class="garage locked" id="garage">üîß Garage ‚Ä¢ Field Manual</div>
<div class="footer">Powered by Cardinal Garage _MND</div>

<div class="overlay" id="paywallPro">
  <div class="panel">
    <h3>Pro Estimate with Sales Insight</h3>
    <p class="sub">Unlock detailed dashboard, downloadable & shareable exports.</p>
    <div class="btn-row"><button class="btn" id="btnBetaPro">‚ö° Join Pro Beta</button><button class="btn" id="btnClosePro">Close</button></div>
  </div>
</div>

<script>
(() => {
  const API = (location.hostname.includes("localhost")||location.hostname.includes("127.0.0.1"))
    ? "http://localhost:3001"
    : "https://jared-hero2-backend.onrender.com";

  const file=document.getElementById('file'),btnUpload=document.getElementById('btnUpload'),btnCamera=document.getElementById('btnCamera'),
        btnEstimate=document.getElementById('btnEstimate'),btnExport=document.getElementById('btnExport'),
        preview=document.getElementById('preview'),previewImg=document.getElementById('previewImg'),
        wheel=document.getElementById('wheel'),wheelText=document.getElementById('wheelText'),
        paywallPro=document.getElementById('paywallPro'),btnBetaPro=document.getElementById('btnBetaPro'),
        btnClosePro=document.getElementById('btnClosePro'),dashHint=document.getElementById('dashHint'),
        tips=document.getElementById('tips'),hudTabs=document.getElementById('hudTabs');

  let uploadCount=Number(localStorage.getItem("jared_uploads")||0),lastSummary="";

  // ===== Upload (2nd triggers paywall)
  btnUpload.onclick=()=>file.click();
  file.onchange=()=>{
    const f=file.files[0]; if(!f) return;
    uploadCount++; localStorage.setItem("jared_uploads",uploadCount);
    if(uploadCount>1&&!localStorage.getItem("jared_pro_unlocked")){paywallPro.style.display='flex';dashHint.style.opacity=.6;return;}
    const url=URL.createObjectURL(f);
    previewReplaceWithImage(url);preview.style.display='block';dashHint.style.opacity=.25;
  };

  // ===== Camera Capture (same gating)
  let camStream=null,camVideo=null,captureBtn=null;
  btnCamera.onclick=openCamera;
  async function openCamera(){
    try{
      const stream=await navigator.mediaDevices.getUserMedia({video:true});
      camStream=stream;
      camVideo=document.createElement("video");camVideo.playsInline=true;camVideo.muted=true;camVideo.srcObject=stream;await camVideo.play();
      preview.style.display='block';previewReplaceWithNode(camVideo);ensureCaptureBtn();
    }catch(e){showTip("Camera access denied.",true);}
  }
  function ensureCaptureBtn(){
    if(captureBtn)captureBtn.remove();
    captureBtn=document.createElement("button");captureBtn.textContent="üì∏ Capture";captureBtn.className="btn";
    captureBtn.style.position="absolute";captureBtn.style.right="10px";captureBtn.style.bottom="10px";preview.appendChild(captureBtn);
    captureBtn.onclick=async()=>{
      if(!camVideo)return;
      const canvas=document.createElement("canvas");canvas.width=camVideo.videoWidth||1280;canvas.height=camVideo.videoHeight||720;
      const g=canvas.getContext("2d");g.drawImage(camVideo,0,0,canvas.width,canvas.height);
      const blob=await new Promise(res=>canvas.toBlob(res,'image/jpeg',0.92));
      if(camStream){camStream.getTracks().forEach(t=>t.stop());camStream=null;}
      camVideo=null;
      uploadCount++;localStorage.setItem("jared_uploads",uploadCount);
      if(uploadCount>1&&!localStorage.getItem("jared_pro_unlocked")){paywallPro.style.display='flex';return;}
      const url=URL.createObjectURL(blob);previewReplaceWithImage(url);file._capturedBlob=blob;showTip("Captured ‚Äî tap Estimate.",true);
    };
  }

  function previewReplaceWithImage(url){const img=document.createElement("img");img.id="previewImg";img.alt="preview";img.src=url;previewReplaceWithNode(img);}
  function previewReplaceWithNode(node){const old=preview.querySelector("img,video");if(old)old.replaceWith(node);else preview.prepend(node);}

  // ===== Estimate
  btnEstimate.onclick=async()=>{
    if(!preview.style.display||preview.style.display==='none'){showTip("Upload or capture a photo first.",true);return;}
    const blob=file._capturedBlob;const fileEl=file.files&&file.files[0];
    if(!blob&&!fileEl){showTip("No image found.",true);return;}
    preview.classList.add('glow-on');wheel.style.display='flex';wheelText.textContent="Analyzing‚Ä¶";
    const formData=new FormData();if(blob)formData.append("file",blob,"capture.jpg");else formData.append("file",fileEl);
    try{
      showTip("Analyzing image‚Ä¶",false);
      const resp=await fetch(`${API}/analyze-image`,{method:"POST",body:formData});
      const data=await resp.json();lastSummary=data.summary||"No summary.";
      showAnalysisTips(lastSummary);hudTabs.style.display='flex';btnExport.classList.remove('hidden');dashHint.style.opacity=.6;
    }catch{showTip("‚ùå Analysis failed.",true);}
    finally{wheel.style.display='none';preview.classList.remove('glow-on');}
  };

  // ===== Export
  btnExport.onclick=()=>{
    if(!localStorage.getItem("jared_pro_unlocked")){paywallPro.style.display='flex';return;}
    const tipsTxt=[...document.querySelectorAll('.tip')].map(e=>e.textContent.trim()).join("\n");
    const blob=new Blob([`Estimate:\n${lastSummary}\n\nTips:\n${tipsTxt}`],{type:"text/plain"});
    const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download="jared_estimate.txt";a.click();
  };

  // ===== Paywall
  btnBetaPro.onclick=()=>{localStorage.setItem("jared_pro_unlocked","1");paywallPro.style.display='none';showTip("‚úÖ Pro unlocked ‚Äî full access granted.",true);};
  btnClosePro.onclick=()=>paywallPro.style.display='none';

  // ===== Tips
  function showTip(text,right=false){const el=document.createElement('div');el.className='tip'+(right?' right':'');el.textContent=text;tips.appendChild(el);requestAnimationFrame(()=>el.classList.add('show'));setTimeout(()=>{el.classList.remove('show');setTimeout(()=>el.remove(),420);},4200);}
  function showAnalysisTips(summary){const bits=(summary.replace(/\s+/g,' ').trim()||"Looks good. Consider fresh mulch; adjust shrub spacing; check edging.").split(/[.;]/).map(s=>s.trim()).filter(Boolean).slice(0,3);let delay=240;bits.forEach((b,i)=>{setTimeout(()=>showTip("üí° "+b,i%2===1),delay);delay+=1500;});setTimeout(()=>showTip("üßæ Estimate ready ‚Äî Export or upgrade to Pro.",true),delay+300);}
})();
</script>
</body>
</html>

