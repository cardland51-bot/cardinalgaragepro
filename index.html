<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ZeroFriction‚Ñ¢ ‚Ä¢ Cardinal GaragePro</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&display=swap" rel="stylesheet">
<style>
  :root{
    --red:#C41E3A;
    --red-dark:#A91B32;
    --bg-top:#ffffff;
    --bg-bot:#f3f3f3;
    --line:#ddd;
    --ink:#111;
    --muted:#555;
  }
  *{box-sizing:border-box}
  html,body{
    margin:0;height:100%;
    font-family:Inter,system-ui,sans-serif;
    color:var(--ink);
    background:linear-gradient(180deg,var(--bg-top),var(--bg-bot));
    overflow-x:hidden;
  }
  header{
    display:flex;justify-content:space-between;align-items:center;
    padding:.8rem 1.2rem;border-bottom:1px solid var(--line);
    background:#fffdfdcc;backdrop-filter:saturate(140%) blur(6px);
  }
  header .brand{font-weight:900;letter-spacing:.08em;color:var(--red-dark)}
  main{display:grid;place-items:center;padding:2rem;text-align:center}
  h1{font-weight:900;letter-spacing:.08em;color:var(--red);margin-bottom:.4rem}
  p{color:var(--muted);max-width:460px;margin:auto}
  .btnRow{margin-top:1rem;display:flex;flex-wrap:wrap;justify-content:center;gap:.6rem}
  .btn{
    border:1px solid var(--line);
    border-radius:999px;
    padding:.7rem 1.3rem;
    font-weight:800;
    cursor:pointer;
    background:#fff;
  }
  .btn.red{color:var(--red);border-color:var(--red)}
  .frame{margin-top:1.4rem;width:min(96vw,600px);aspect-ratio:16/9;border:1px solid var(--line);border-radius:12px;overflow:hidden;display:none;position:relative}
  .frame img,.frame video{width:100%;height:100%;object-fit:cover}
  .badge{position:absolute;bottom:10px;right:10px;background:#fff;border:1px solid var(--line);border-radius:999px;padding:.4rem .7rem;font-size:.8rem;display:none}
  .result{margin-top:1rem;border:1px solid var(--line);background:#fff;border-radius:12px;padding:1rem;display:none;text-align:left;max-width:600px}
  .result strong{color:var(--red-dark)}
  footer{margin-top:2rem;text-align:center;font-size:11px;letter-spacing:.1em;color:#777}

  /* === Calculator Drawer === */
  #drawerToggle{
    position:fixed;bottom:20px;right:20px;
    background:var(--red);color:#fff;
    border:none;border-radius:50%;width:58px;height:58px;
    font-size:26px;cursor:pointer;box-shadow:0 6px 20px rgba(0,0,0,.2);
  }
  #calcDrawer{
    position:fixed;top:0;right:-350px;height:100%;width:340px;
    background:#fff;border-left:3px solid var(--red);
    box-shadow:-10px 0 28px rgba(0,0,0,.1);
    transition:right .4s ease;
    display:flex;flex-direction:column;align-items:center;padding:1.2rem;overflow-y:auto;
  }
  #calcDrawer.open{right:0;}
  #calcDrawer h3{color:var(--red-dark);margin:.6rem 0 1rem}
  .in{
    width:100%;padding:.5rem;border:1px solid var(--line);
    border-radius:8px;margin-bottom:.8rem;
  }
  select.in{background:#fff}
  #calcOut{white-space:pre-line;font-weight:600;color:#333;margin-top:1rem}
  .calcBtn{
    background:var(--red);color:#fff;border:none;
    border-radius:8px;padding:.7rem 1rem;
    font-weight:800;cursor:pointer;width:100%;margin-top:.4rem;
  }
  .calcBtn:hover{background:var(--red-dark);}
</style>
</head>
<body>
<header>
  <div class="brand">CARDINAL SYSTEMS</div>
  <div class="brand">ZeroFriction‚Ñ¢</div>
</header>

<main>
  <h1>UPLOAD ‚Üí ESTIMATE ‚Üí SEND</h1>
  <p>Instant AI-driven field estimator. Risk, duration, and pricing revealed in seconds.</p>
  <div class="btnRow">
    <button class="btn" id="btnUpload">Upload</button>
    <button class="btn" id="btnCamera">Camera</button>
    <button class="btn red" id="btnAnalyze">Analyze</button>
  </div>

  <div class="frame" id="frame">
    <img id="previewImg" alt="preview" />
    <div class="badge" id="busy">Analyzing‚Ä¶</div>
  </div>

  <div class="result" id="result">
    <div id="summary"></div>
  </div>
</main>

<footer>POWERED BY CARDINAL SYSTEMS ‚Ä¢ ZEROFRICTION‚Ñ¢ SUITE</footer>

<!-- Calculator Drawer -->
<button id="drawerToggle">‚öôÔ∏è</button>
<div id="calcDrawer">
  <h3>Estimator Utility</h3>
  <input class="in" id="c_yard" placeholder="Yard size (sq ft)" type="number">
  <select class="in" id="c_freq">
    <option value="weekly">Weekly</option>
    <option value="biweekly">Bi-Weekly</option>
    <option value="monthly">Monthly</option>
    <option value="rarely">Rarely</option>
  </select>
  <input class="in" id="c_mulchBeds" placeholder="Number of mulch beds" type="number">
  <input class="in" id="c_shrubs" placeholder="Number of shrubs" type="number">
  <select class="in" id="c_weeds">
    <option value="none">No weeds</option>
    <option value="moderate">Moderate</option>
    <option value="overgrown">Overgrown</option>
    <option value="taken">Taken over</option>
  </select>
  <input class="in" id="c_effort" placeholder="Effort multiplier (1.0 - 2.0)" type="number" step="0.1" value="1.0">
  <button class="calcBtn" id="btnCalc">Calculate</button>
  <pre id="calcOut"></pre>
</div>

<script>
(() => {
/* ========= CONFIG / GATE ========= */
const CONFIG = { API_BASE: "https://cardinalgaragepro.com" };

/* ========= ELEMENTS ========= */
const el = {
  frame: document.getElementById("frame"),
  img: document.getElementById("previewImg"),
  busy: document.getElementById("busy"),
  upload: document.getElementById("btnUpload"),
  camera: document.getElementById("btnCamera"),
  analyze: document.getElementById("btnAnalyze"),
  result: document.getElementById("result"),
  summary: document.getElementById("summary"),
  drawer: document.getElementById("calcDrawer"),
  drawerToggle: document.getElementById("drawerToggle"),
  calcBtn: document.getElementById("btnCalc"),
  yard: document.getElementById("c_yard"),
  freq: document.getElementById("c_freq"),
  mulchBeds: document.getElementById("c_mulchBeds"),
  shrubs: document.getElementById("c_shrubs"),
  weeds: document.getElementById("c_weeds"),
  effort: document.getElementById("c_effort"),
  calcOut: document.getElementById("calcOut"),
  fileInput: (()=>{const f=document.createElement("input");f.type="file";f.accept="image/*";f.hidden=true;document.body.appendChild(f);return f})()
};

/* ========= Drawer Control ========= */
el.drawerToggle.onclick=()=>el.drawer.classList.toggle("open");

/* ========= Upload / Camera / Analyze ========= */
el.upload.onclick=()=>el.fileInput.click();
el.fileInput.onchange=()=>{const f=el.fileInput.files[0];if(!f)return;const url=URL.createObjectURL(f);showPreview(url);};
el.camera.onclick=()=>openCamera();
el.analyze.onclick=()=>analyzeCore();

function showPreview(url){
  const img=document.createElement("img");
  img.src=url;
  el.frame.style.display="block";
  const old=el.frame.querySelector("img,video");
  if(old) old.replaceWith(img); else el.frame.prepend(img);
}

async function openCamera(){
  try{
    const stream=await navigator.mediaDevices.getUserMedia({video:true});
    const v=document.createElement("video");
    v.srcObject=stream;v.muted=true;v.playsInline=true;await v.play();
    el.frame.style.display="block";el.frame.prepend(v);
    const cap=document.createElement("button");
    cap.textContent="Capture";cap.className="btn red";
    cap.style.position="absolute";cap.style.bottom="10px";cap.style.left="10px";
    el.frame.appendChild(cap);
    cap.onclick=async()=>{
      const c=document.createElement("canvas");
      c.width=v.videoWidth;c.height=v.videoHeight;
      c.getContext("2d").drawImage(v,0,0,c.width,c.height);
      const blob=await new Promise(r=>c.toBlob(r,'image/jpeg',0.9));
      stream.getTracks().forEach(t=>t.stop());
      const url=URL.createObjectURL(blob);
      showPreview(url);cap.remove();
    };
  }catch{alert("Camera not available.");}
}

/* ========= AI ANALYZE ========= */
async function analyzeCore(){
  const node=el.frame.querySelector("img,video");
  if(!node){alert("Upload or capture a photo first.");return;}
  el.busy.style.display="inline-flex";el.result.style.display="none";

  try{
    let blob;
    if(node.tagName==="VIDEO"){
      const c=document.createElement("canvas");
      c.width=node.videoWidth;c.height=node.videoHeight;
      c.getContext("2d").drawImage(node,0,0,c.width,c.height);
      blob=await new Promise(r=>c.toBlob(r,"image/jpeg",0.9));
    }else{
      const resp=await fetch(node.src);blob=await resp.blob();
    }

    const fd=new FormData();fd.append("file",blob,"capture.jpg");
    const resp=await fetch(`${CONFIG.API_BASE}/analyze`,{method:"POST",body:fd});
    if(!resp.ok)throw new Error("Analyze failed");
    const data=await resp.json();
    const text=(data.text||"").trim();
    const priceMatch=text.match(/\$[0-9]+(?:\.[0-9]{1,2})?/);
    const summaryLine=priceMatch?`üí∞ Estimated Price: ${priceMatch[0]}\n${text}`:text;
    el.summary.textContent=summaryLine;
    el.result.style.display="block";
  }catch(err){console.error(err);alert("Analysis failed.");}
  finally{el.busy.style.display="none";}
}

/* ========= CALCULATOR (Effort Logic) ========= */
el.calcBtn.onclick=()=>{
  const yard=+el.yard.value||0;
  const freq=el.freq.value;
  const mulchBeds=+el.mulchBeds.value||0;
  const shrubs=+el.shrubs.value||0;
  const weeds=el.weeds.value;
  const effort=+el.effort.value||1;

  let base=yard*0.005;
  const freqMod={weekly:.8,biweekly:1,monthly:1.2,rarely:1.4}[freq]||1;
  const weedMod={none:1,moderate:1.1,overgrown:1.25,taken:1.45}[weeds]||1;
  const mulch=mulchBeds*100;
  const shrubTrim=Math.max(1,Math.ceil(shrubs/12))*100;
  let total=Math.round((base+mulch+shrubTrim)*freqMod*weedMod*effort);
  const upsellMin=Math.round(total*.25),upsellMax=Math.round(total*.45);

  const out=`üí∞ Estimate: $${total}
‚Ä¢ Risk: ${weeds}
‚Ä¢ Effort Multiplier: x${effort}
‚Ä¢ Upsell Potential: +$${upsellMin}‚Äì$${upsellMax}`;
  el.calcOut.textContent=out;
};
})();
</script>
</body>
</html>
