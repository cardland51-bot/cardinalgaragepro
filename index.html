<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Cardinal Garage Pro â€¢ HeroHUD</title>

<style>
  :root{
    --mint:#9CFFE0;
    --bg:#0b1b16;
  }
  html,body{
    margin:0;padding:0;
    background:var(--bg);
    color:var(--mint);
    font-family:system-ui,Arial,sans-serif;
    height:100%;
    overflow:hidden;
  }

  /* ===== Voice orb + indicator ===== */
  #voiceOrb{
    position:fixed;
    left:18px;
    bottom:80px;
    width:54px;
    height:54px;
    border-radius:999px;
    border:1px solid var(--mint);
    background:radial-gradient(circle at 60% 40%,rgba(156,255,224,.25),rgba(47,176,233,.12));
    box-shadow:0 0 16px rgba(156,255,224,.25);
    z-index:60;
    display:grid;
    place-items:center;
    cursor:pointer;
  }
  #voiceOrb.idle{box-shadow:0 0 10px rgba(156,255,224,.2);}
  #voiceOrb.listening{animation:pulse 1.4s ease-in-out infinite;}
  #voiceOrb.speaking{
    box-shadow:0 0 20px rgba(156,255,224,.45),
               0 0 28px rgba(47,176,233,.35);
  }
  @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}

  #listeningIndicator{
    position:fixed;
    bottom:150px;
    left:50%;
    transform:translateX(-50%) translateY(10px);
    font-size:14px;
    color:var(--mint);
    text-shadow:0 0 8px rgba(156,255,224,.4);
    opacity:0;
    transition:opacity .3s ease,transform .3s ease;
    z-index:99;
  }
  #listeningIndicator.visible{
    opacity:1;
    transform:translateX(-50%) translateY(0);
    animation:textPulse 1.6s ease-in-out infinite;
  }
  @keyframes textPulse{0%,100%{opacity:.7;}50%{opacity:1;}}
</style>
</head>

<body>
  <!-- whatever main content you want goes here -->
  <div id="voiceOrb" class="idle" title="Tap to talk / Tap to stop"></div>
  <div id="listeningIndicator" class="hidden">ðŸŽ§ Listeningâ€¦</div>

<script>
const orb=document.getElementById("voiceOrb");
const indicator=document.getElementById("listeningIndicator");

let recording=false,mediaRecorder,audioChunks=[];

orb.onclick=async()=>{
  if(!recording){
    recording=true;
    orb.classList.remove("idle","speaking");
    orb.classList.add("listening");
    indicator.classList.add("visible");

    const stream=await navigator.mediaDevices.getUserMedia({audio:true});
    mediaRecorder=new MediaRecorder(stream);
    audioChunks=[];
    mediaRecorder.ondataavailable=e=>audioChunks.push(e.data);
    mediaRecorder.onstop=async()=>{
      orb.classList.remove("listening");
      indicator.classList.remove("visible");
      orb.classList.add("speaking");

      const audioBlob=new Blob(audioChunks,{type:"audio/webm"});
      const formData=new FormData();
      formData.append("audio",audioBlob,"speech.webm");

      try{
        const trans=await fetch("https://cardinalgaragepro.com/transcribe",{method:"POST",body:formData});
        const result=await trans.json();
        if(result.text){
          const infer=await fetch("https://cardinalgaragepro.com/inference",{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({text:result.text,mode:"pro"})
          });
          const ai=await infer.json();
          const speak=await fetch("https://cardinalgaragepro.com/speak",{
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({text:ai.content})
          });
          const buffer=await speak.arrayBuffer();
          const blob=new Blob([buffer],{type:"audio/mpeg"});
          const url=URL.createObjectURL(blob);
          const audio=new Audio(url);
          audio.onended=()=>{
            orb.classList.remove("speaking");
            orb.classList.add("idle");
          };
          audio.play();
        }
      }catch(err){
        console.error("Error:",err);
        orb.classList.remove("speaking","listening");
        orb.classList.add("idle");
      }
    };
    mediaRecorder.start();
  }else{
    recording=false;
    mediaRecorder.stop();
  }
};
</script>
</body>
</html>
