<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1,user-scalable=no" />
<title>HeroHUD ‚Ä¢ Upload ‚Üí Analyze ‚Üí Send</title>
<meta name="theme-color" content="#0b1b16" />
<style>
  :root{
    --bg-top:#0b1b16; --bg-bot:#06121a;
    --mintL:#9CFFE0; --mint:#34D1A0; --aqua:#2FB0E9; --teal:#0E8B67;
    --text:#E9FFF6; --textDim:rgba(233,255,246,.85);
    --glass:rgba(255,255,255,0.05); --stroke:rgba(156,255,224,0.28);
  }
  html,body{margin:0;height:100%;background:linear-gradient(180deg,var(--bg-top),var(--bg-bot));color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  *{box-sizing:border-box}

  /* Ambient films */
  body::before, body::after{content:""; position:fixed; inset:0; pointer-events:none}
  body::before{
    background:
      radial-gradient(130% 90% at 50% 6%, rgba(156,255,224,.10), transparent 45%),
      radial-gradient(120% 80% at 50% 95%, rgba(47,176,233,.12), transparent 55%);
    animation:film1 14s ease-in-out infinite alternate; opacity:.8;
  }
  body::after{
    background:
      linear-gradient( to right, transparent 0%, rgba(156,255,224,.05) 30%, transparent 60%),
      linear-gradient( to left, transparent 0%, rgba(47,176,233,.05) 30%, transparent 60%);
    mix-blend-mode:screen; animation:film2 18s linear infinite; opacity:.7;
  }
  @keyframes film1{to{transform:translateY(-2%)}}
  @keyframes film2{to{transform:translateX(-2%)}}

  /* Top branding */
  .topbar{position:fixed;inset:0 0 auto 0;height:64px;display:grid;place-items:center;z-index:10}
  .brand{font-weight:900;letter-spacing:.08em}
  .brand .hero{color:var(--mintL)}

  /* Stage */
  .stage{position:fixed;inset:64px 0 160px 0;display:grid;place-items:center;padding:18px}
  .stack{display:flex;flex-direction:column;align-items:center;text-align:center;gap:12px;max-width:960px;width:100%}

  /* Buttons */
  .btn{appearance:none;border:1px solid var(--mint);background:var(--glass);color:var(--mintL);
    padding:.85rem 1.4rem;border-radius:999px;letter-spacing:.08em;text-transform:uppercase;
    font-weight:700;backdrop-filter:blur(6px);cursor:pointer;transition:box-shadow .2s,transform .1s,opacity .2s;
    box-shadow:0 0 16px rgba(156,255,224,.14);font-size:13px;position:relative;overflow:hidden;user-select:none}
  .btn:hover{box-shadow:0 0 26px rgba(156,255,224,.45),0 0 24px rgba(47,176,233,.25)}
  .btn:active{transform:translateY(1px)}
  .btn.hidden{display:none}
  .btn.locked{opacity:.55;cursor:not-allowed}
  .btn-row{display:flex;gap:10px;flex-wrap:wrap;justify-content:center}

  /* Preview */
  #preview{display:none;position:relative;width:min(94vw,960px);aspect-ratio:16/10;border-radius:16px;overflow:hidden;border:1px solid var(--stroke);box-shadow:0 0 24px rgba(156,255,224,.14)}
  #preview img,#preview video{width:100%;height:100%;object-fit:cover}
  #edgeGlow{position:absolute;inset:0;border-radius:16px;pointer-events:none;opacity:0;
    box-shadow:0 0 28px rgba(156,255,224,.6),inset 0 0 18px rgba(14,139,103,.55);transition:opacity .25s}
  .glow-on #edgeGlow{opacity:1}
  .wheel{position:absolute;inset:auto auto 10px 10px;background:rgba(0,0,0,.45);border:1px solid var(--stroke);
    border-radius:999px;padding:.35rem .6rem;font-size:12px;display:flex;gap:.5rem;align-items:center}
  .mini-spin{width:14px;height:14px;border-radius:50%;border:2px solid rgba(156,255,224,.35);border-top-color:var(--mintL);animation:spin 1s linear infinite}
  @keyframes spin{to{transform:rotate(360deg)}}

  /* Tip bubbles under photo (no chat boxes anywhere else) */
  #tips{position:relative;width:min(94vw,960px);min-height:14px}
  .tip{opacity:0;transform:translateY(8px);transition:all .4s ease;background:rgba(255,255,255,.06);
    border:1px solid var(--stroke);backdrop-filter:blur(8px);color:var(--text);padding:.55rem .75rem;border-radius:10px;
    box-shadow:0 0 18px rgba(156,255,224,.25);margin:.35rem auto;max-width:92%}
  .tip.show{opacity:1;transform:translateY(0)}
  .tip.right{text-align:right}

  /* Modules tabs (labels only) */
  .hud{display:none;gap:8px;margin-top:8px;flex-wrap:wrap;justify-content:center}
  .tab{padding:.45rem .8rem;border:1px solid var(--stroke);border-radius:999px;background:rgba(255,255,255,.04);color:var(--textDim);font-size:12px}

  /* Footer + Garage trigger */
  .footer{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;font-size:12px;color:rgba(233,255,246,.6);letter-spacing:.12em;text-transform:uppercase}
  .garage-trigger{position:fixed;right:14px;bottom:48px;background:rgba(255,255,255,.05);border:1px solid var(--stroke);
    border-radius:12px;padding:.45rem .65rem;display:flex;align-items:center;gap:.45rem;cursor:pointer;
    box-shadow:0 0 12px rgba(156,255,224,.18);font-size:12px;z-index:15}

  /* Garage roll-down door */
  #garageDoor{position:fixed;left:0;right:0;top:0;height:0;overflow:hidden;z-index:70;pointer-events:none}
  #garageDoor .door{height:420px;background:
      linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03)),
      repeating-linear-gradient(180deg, rgba(156,255,224,.08), rgba(156,255,224,.08) 6px, rgba(255,255,255,0.02) 6px, rgba(255,255,255,0.02) 14px);
    border-bottom:1px solid var(--stroke); box-shadow:0 10px 40px rgba(0,0,0,.45), inset 0 -8px 24px rgba(156,255,224,.12);
    display:flex;flex-direction:column;align-items:center;justify-content:flex-start;gap:12px;padding:14px 10px; position:relative}
  #garageDoor.open{height:420px;pointer-events:auto;transition:height .9s cubic-bezier(.2,.9,.2,1)}
  #garageDoor.close{height:0;transition:height .8s cubic-bezier(.2,.9,.2,1)}
  .gTitle{font-weight:900;letter-spacing:.16em;color:var(--mintL);margin-top:4px}
  .gClose{position:absolute;right:10px;top:10px;border:1px solid var(--stroke);background:rgba(255,255,255,.04);color:var(--text);border-radius:999px;padding:.35rem .6rem;cursor:pointer}

  .gRow{display:flex;gap:12px;max-width:980px;width:calc(100% - 20px);justify-content:center;flex-wrap:wrap;margin-top:6px}
  .card{flex:1 1 280px;max-width:320px;background:rgba(255,255,255,.05);border:1px solid var(--stroke);border-radius:14px;padding:12px 12px 14px;
    box-shadow:0 0 26px rgba(156,255,224,.18)}
  .tag{display:inline-block;border:1px solid var(--mint);color:var(--mintL);padding:.25rem .5rem;border-radius:999px;font-size:11px;margin-bottom:8px}
  .price{margin-top:8px;opacity:.9}
  .card .btn-row{justify-content:flex-start}

  /* Paywall overlay */
  .overlay{display:none;position:fixed;inset:0;background:rgba(3,8,6,.82);backdrop-filter:blur(6px);align-items:center;justify-content:center;z-index:80}
  .panel{max-width:560px;margin:20px;background:rgba(255,255,255,.06);border:1px solid var(--stroke);
    border-radius:16px;padding:1.1rem 1.3rem;text-align:center;box-shadow:0 0 32px rgba(156,255,224,.28)}

  /* Boot titles */
  #bootTitles{position:fixed;inset:64px 0 0 0;display:grid;place-items:center;pointer-events:none;z-index:50}
  .bt{font-weight:900;letter-spacing:.22em;color:var(--mintL);font-size:clamp(22px,6vw,64px);opacity:0;transform:translateY(8px);transition:all .5s ease}
  .bt.show{opacity:1;transform:translateY(0)}

  /* Full-screen boot veil */
  #bootVeil{position:fixed;inset:0;background:#03100c;z-index:90;display:flex;align-items:center;justify-content:center;flex-direction:column}
  #bootWheel{display:flex;gap:.5rem;align-items:center;border:1px solid var(--stroke);background:rgba(255,255,255,.04);padding:.6rem .9rem;border-radius:999px}
  #bootWheel .mini-spin{border-color:rgba(156,255,224,.35);border-top-color:var(--mintL)}
</style>
</head>
<body>
  <div class="topbar"><div class="brand"><span class="hero">HEROHUD</span></div></div>

  <!-- Cinematic boot -->
  <div id="bootVeil">
    <div id="bootWheel"><div class="mini-spin"></div><span>Waking up‚Ä¶</span></div>
  </div>
  <div id="bootTitles">
    <div class="bt" id="bt1">UPLOAD</div>
    <div class="bt" id="bt2">ANALYZE</div>
    <div class="bt" id="bt3">SEND</div>
  </div>

  <!-- Garage roll-down -->
  <div id="garageDoor" class="close">
    <div class="door">
      <button class="gClose" id="garageCloseBtn">Close</button>
      <div class="gTitle">GARAGE ‚Ä¢ Cardinal-Garage_Mnd.inc</div>
      <div style="opacity:.85;font-size:12px;margin-top:-4px">Founders ‚Ä¢ Sales University ‚Ä¢ Upgrades ‚Ä¢ Control Center</div>

      <div class="gRow">
        <div class="card">
          <span class="tag">üü¢ Access+</span>
          <div>Unlimited uploads & analyses ‚Äî your field freedom pass.</div>
          <div class="price">$29 / month</div>
          <div class="btn-row">
            <button class="btn" id="btnAccessMonthly">Activate</button>
          </div>
        </div>

        <div class="card">
          <span class="tag">‚ö° Pro Sales Insight</span>
          <div>Client-ready reports that close deals.</div>
          <div class="price">
            <label><input type="radio" name="proMode" value="single" checked> $39 / report</label><br/>
            <label><input type="radio" name="proMode" value="unlimited"> $89 / month</label>
          </div>
          <div class="btn-row">
            <button class="btn" id="btnProActivate">Activate</button>
          </div>
        </div>

        <div class="card">
          <span class="tag">üéì Sales University</span>
          <div>One-week sprint built from elite sales systems.</div>
          <div class="price">$99 / week</div>
          <div class="btn-row">
            <button class="btn" id="btnSalesU">Enter</button>
            <button class="btn" id="btnSalesUDemo">Grant 1 Extra Demo</button>
          </div>
        </div>

        <div class="card">
          <span class="tag">üß† Hero Complete</span>
          <div>Full ecosystem: Access+, Pro, SalesU, Founders‚Äô Control.</div>
          <div class="price">$129 / month</div>
          <div class="btn-row">
            <button class="btn" id="btnHeroComplete">Activate</button>
          </div>
        </div>

        <div class="card">
          <span class="tag">ü™ô Founder Lifetime</span>
          <div>Permanent license + branding + advanced metrics.</div>
          <div class="price">$799 one-time</div>
          <div class="btn-row">
            <button class="btn" id="btnFounderLifetime">Activate</button>
          </div>
        </div>

        <div class="card">
          <span class="tag">üìä Founder‚Äôs Control Center</span>
          <div>Pitch, org, stack, live metrics, projections ‚Äî in one PDF.</div>
          <div class="btn-row">
            <button class="btn" id="btnFounderDeck">Generate Deck (PDF)</button>
            <button class="btn" id="btnDownloadLogs">Download Logs</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main UI -->
  <div class="stage">
    <div class="stack">
      <div class="btn-row">
        <button class="btn" id="btnUpload">‚¨Ü Upload Photo</button>
        <button class="btn" id="btnCamera">üì∑ Camera</button>
        <button class="btn" id="btnAnalyze">üîç Analyze</button>
        <button class="btn hidden" id="btnExport">üì§ Pro Export</button>
      </div>

      <div id="preview">
        <img id="previewImg" alt="preview" />
        <div id="edgeGlow"></div>
        <div class="wheel" id="wheel" style="display:none;">
          <div class="mini-spin"></div><span id="wheelText">Analyzing‚Ä¶</span>
        </div>
        <div id="dashHint" style="position:absolute;inset:0;opacity:.0;pointer-events:none;"></div>
      </div>

      <!-- Tips only (no chat boxes) -->
      <div id="tips"></div>

      <!-- Labels for modules (visual hint only) -->
      <div class="hud" id="hudTabs">
        <div class="tab">Insights</div>
        <div class="tab">Field Guides</div>
        <div class="tab">Sales U.</div>
        <div class="tab">Best Practices</div>
        <div class="tab">Ledger</div>
        <div class="tab">Founders</div>
      </div>

      <input type="file" id="file" accept="image/*" hidden />
    </div>
  </div>

  <div class="garage-trigger" id="garageTrigger">üß∞ Garage</div>
  <div class="footer">Powered by Cardinal-Garage_Mnd.inc ‚Ä¢ Precision Meets Grit</div>

  <!-- Generic paywall overlay -->
  <div class="overlay" id="paywall">
    <div class="panel">
      <h3 id="paywallTitle">Upgrade Required</h3>
      <p id="paywallMsg" class="sub">Unlock to continue.</p>
      <div class="btn-row">
        <button class="btn" id="btnProOnce">$39 / report</button>
        <button class="btn" id="btnProMonthly">$89 / month</button>
        <button class="btn" id="btnPaywallClose">Close</button>
      </div>
    </div>
  </div>

<script>
(() => {
  /* =========================
     CONFIG
  ==========================*/
  const API = (location.hostname.includes("localhost")||location.hostname.includes("127.0.0.1"))
    ? "http://localhost:3001"
    : "https://jared-hero2-backend.onrender.com";

  /* =========================
     ELEMENTS
  ==========================*/
  const el = {
    file: q('#file'),
    btnUpload: q('#btnUpload'),
    btnCamera: q('#btnCamera'),
    btnAnalyze: q('#btnAnalyze'),
    btnExport: q('#btnExport'),
    preview: q('#preview'),
    previewImg: q('#previewImg'),
    edgeGlow: q('#edgeGlow'),
    wheel: q('#wheel'),
    wheelText: q('#wheelText'),
    dashHint: q('#dashHint'),
    tips: q('#tips'),
    hudTabs: q('#hudTabs'),
    garageTrigger: q('#garageTrigger'),
    garageDoor: q('#garageDoor'),
    garageCloseBtn: q('#garageCloseBtn'),
    paywall: q('#paywall'),
    paywallTitle: q('#paywallTitle'),
    paywallMsg: q('#paywallMsg'),
    btnProOnce: q('#btnProOnce'),
    btnProMonthly: q('#btnProMonthly'),
    btnPaywallClose: q('#btnPaywallClose'),
    btnAccessMonthly: q('#btnAccessMonthly'),
    btnProActivate: q('#btnProActivate'),
    btnSalesU: q('#btnSalesU'),
    btnSalesUDemo: q('#btnSalesUDemo'),
    btnHeroComplete: q('#btnHeroComplete'),
    btnFounderLifetime: q('#btnFounderLifetime'),
    btnFounderDeck: q('#btnFounderDeck'),
    btnDownloadLogs: q('#btnDownloadLogs'),
    boot: { veil:q('#bootVeil'), t1:q('#bt1'), t2:q('#bt2'), t3:q('#bt3') }
  };

  /* =========================
     STATE
  ==========================*/
  const STATE = {
    proUnlocked: localStorage.getItem('herohud_pro_unlocked')==='1',
    accessUnlocked: localStorage.getItem('herohud_access_unlocked')==='1',
    salesUDemo: localStorage.getItem('herohud_salesu_demo')==='1',
    uploadsToday: getUploadsToday(),
    lastSummary: "",
    logs: loadLogs(), // { entries: [], startedAt }
    demoUsed: localStorage.getItem('herohud_demo_analysis_used')==='1',
    analyzing: false,
    isBooted: false,
    proMode: 'single' // 'single' | 'unlimited'
  };

  /* =========================
     UTIL
  ==========================*/
  function q(s){return document.querySelector(s)}
  function nowKey(){ const d=new Date(); return d.getFullYear()+'-'+(d.getMonth()+1)+'-'+d.getDate() }
  function getUploadsToday(){
    const key = localStorage.getItem('herohud_uploads_key');
    const count = Number(localStorage.getItem('herohud_uploads_count')||0);
    const today = nowKey();
    return key===today?count:0;
  }
  function bumpUploads(){
    const today = nowKey();
    localStorage.setItem('herohud_uploads_key', today);
    const n = STATE.uploadsToday+1;
    localStorage.setItem('herohud_uploads_count', String(n));
    STATE.uploadsToday = n;
  }
  function escapeHTML(s){return s.replace(/[&<>"']/g,m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]))}
  function logEvent(kind, payload){
    STATE.logs.entries.push({ t:Date.now(), kind, payload });
    localStorage.setItem('herohud_logs', JSON.stringify(STATE.logs));
  }
  function loadLogs(){
    const raw = localStorage.getItem('herohud_logs');
    return raw ? JSON.parse(raw) : { startedAt: Date.now(), entries: [] };
  }
  function downloadText(filename, text){
    const blob=new Blob([text],{type:"text/plain"});
    const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download=filename; a.click();
  }

  /* =========================
     SPEECH QUEUE (no overlap)
  ==========================*/
  let speakQueue = [];
  let isSpeaking = false;

  function speak(line, priority=2){
    // priority: 1=critical (interrupt), 2=operational (queue), 3=ambient (skip if busy)
    if(priority===1){
      window.speechSynthesis.cancel();
      isSpeaking = false;
      speakQueue = []; // clear queue
    }
    if(priority===3 && (isSpeaking || speakQueue.length)) return; // skip ambient if busy

    speakQueue.push({ line, priority });
    processSpeakQueue();
  }

  function processSpeakQueue(){
    if(isSpeaking || speakQueue.length===0) return;
    const next = speakQueue.shift();
    if(!next) return;
    isSpeaking = true;

    const utter = new SpeechSynthesisUtterance(next.line);
    utter.rate = 1.0; utter.pitch = 1.02; // calm confident
    const voices = speechSynthesis.getVoices();
    const pick = voices.find(v => /Microsoft|Google|Alex|Daniel|Samantha|Male/i.test(v.name)) || voices.find(v => v.default) || voices[0];
    if(pick) utter.voice = pick;

    utter.onend = () => {
      isSpeaking = false;
      processSpeakQueue();
    };
    utter.onerror = () => {
      isSpeaking = false;
      processSpeakQueue();
    };

    window.speechSynthesis.speak(utter);
    logEvent('voice', { text: next.line });
  }

  /* =========================
     TIPS
  ==========================*/
  function showTip(text,right=false){
    const t = document.createElement('div');
    t.className = 'tip'+(right?' right':'' );
    t.textContent = text;
    el.tips.appendChild(t);
    requestAnimationFrame(()=>t.classList.add('show'));
    setTimeout(()=>{ t.classList.remove('show'); setTimeout(()=>t.remove(),380); }, 4200);
  }

  function showAnalysisTips(summary){
    const bits=(summary||"Consider mulch depth; define bed edge; check irrigation coverage.")
      .replace(/\s+/g,' ').trim().split(/[.;]/).map(s=>s.trim()).filter(Boolean).slice(0,3);
    let delay=240;
    bits.forEach((b,i)=>{ setTimeout(()=>showTip("üí° "+b, i%2===1), delay); delay+=1400; });
    setTimeout(()=>showTip("üßæ Pro Sales Insight available ‚Äî tap Pro Export.", true), delay+260);
  }

  /* =========================
     GARAGE
  ==========================*/
  function openGarage(){
    el.garageDoor.classList.remove('close'); el.garageDoor.classList.add('open');
    speak("Garage opened. Upgrades, training, and your founder controls are available here.", 2);
  }
  function closeGarage(){
    el.garageDoor.classList.remove('open'); el.garageDoor.classList.add('close');
  }

  /* =========================
     PAYWALL
  ==========================*/
  function openPaywall(title,msg){
    el.paywallTitle.textContent = title;
    el.paywallMsg.textContent = msg;
    el.paywall.style.display='flex';
  }
  function closePaywall(){ el.paywall.style.display='none' }

  /* =========================
     BOOT SEQUENCE (Cinematic + Mentor)
  ==========================*/
  async function boot(){
    // Lock controls
    disableMainControls(true);

    // Voice sequence (no text boxes, only audio)
    speak("Initializing HeroHUD systems.", 1);
    await wait(1300);
    speak("Good morning, Operator ‚Äî I‚Äôm awake and online.", 2);
    await wait(1500);
    speak("Field modules standing by.", 2);
    await wait(700);
    speak("I‚Äôm Jared ‚Äî your AI field strategist and personal sales coach.", 2);
    await wait(1500);
    speak("Here‚Äôs how we‚Äôll work together.", 2);
    await wait(700);
    // Sync HUD titles
    setTimeout(()=>el.boot.t1.classList.add('show'), 50);
    speak("Step one ‚Äî upload a photo from the field.", 2);
    await wait(850);
    setTimeout(()=>el.boot.t2.classList.add('show'), 150);
    speak("Step two ‚Äî I‚Äôll analyze it, identify opportunities, and guide your next move.", 2);
    await wait(950);
    setTimeout(()=>el.boot.t3.classList.add('show'), 150);
    speak("Step three ‚Äî export your professional report ‚Äî or upgrade for deeper sales insight.", 2);
    await wait(1400);
    speak("Whether you‚Äôre closing clients, building your business, or learning the ropes ‚Äî I‚Äôm here to help you sell smarter and faster.", 2);
    await wait(1200);
    speak("HeroHUD is online. Let‚Äôs get to work.", 2);

    // Reveal UI
    setTimeout(()=>{ el.boot.t1.style.display='none'; el.boot.t2.style.display='none'; el.boot.t3.style.display='none'; }, 900);
    setTimeout(()=>{ el.boot.veil.style.display='none'; }, 1000);
    disableMainControls(false);
    STATE.isBooted = true;
  }

  function disableMainControls(disabled){
    [el.btnUpload, el.btnCamera, el.btnAnalyze, el.btnExport, el.garageTrigger].forEach(b=>{
      if(!b) return;
      b.disabled = !!disabled;
      b.classList.toggle('locked', !!disabled);
    });
  }

  /* =========================
     UPLOAD GATE (2/day unless Access+)
  ==========================*/
  function canUpload(){
    if(STATE.accessUnlocked) return true;
    // allow +1 extra if SalesU demo granted and demo not used
    const room = STATE.uploadsToday < 2 || (!STATE.demoUsed && STATE.salesUDemo && STATE.uploadsToday < 3);
    return room;
  }
  function enforceUploadGate(){
    if(canUpload()) return true;
    speak("Daily access limit reached. Access Plus unlocks unlimited uploads and analyses.", 2);
    openPaywall("Access Limit Reached","Unlock Access+ for unlimited uploads and analyses.");
    return false;
  }

  /* =========================
     CAMERA
  ==========================*/
  let camStream=null,camVideo=null,captureBtn=null;
  async function openCamera(){
    if(!enforceUploadGate()) return;
    try{
      const stream=await navigator.mediaDevices.getUserMedia({video:true});
      camStream=stream;
      camVideo=document.createElement("video");
      camVideo.playsInline=true; camVideo.muted=true; camVideo.srcObject=stream; await camVideo.play();
      el.preview.style.display='block'; previewReplaceWithNode(camVideo); ensureCaptureBtn();
      speak("Camera online. Capture when ready.", 3);
    }catch(e){ showTip("Camera access denied.",true); }
  }
  function ensureCaptureBtn(){
    if(captureBtn) captureBtn.remove();
    captureBtn=document.createElement("button");
    captureBtn.textContent="üì∏ Capture"; captureBtn.className="btn";
    captureBtn.style.position="absolute"; captureBtn.style.right="10px"; captureBtn.style.bottom="10px";
    el.preview.appendChild(captureBtn);
    captureBtn.onclick=async()=>{
      if(!camVideo) return;
      const canvas=document.createElement("canvas");
      canvas.width=camVideo.videoWidth||1280; canvas.height=camVideo.videoHeight||720;
      const g=canvas.getContext("2d"); g.drawImage(camVideo,0,0,canvas.width,canvas.height);
      const blob=await new Promise(res=>canvas.toBlob(res,'image/jpeg',0.92));
      if(camStream){camStream.getTracks().forEach(t=>t.stop()); camStream=null;}
      camVideo=null;
      const url=URL.createObjectURL(blob); previewReplaceWithImage(url);
      el.preview.style.display='block'; el.dashHint.style.opacity=.25;
      el.file._capturedBlob = blob;
      bumpUploads(); showTip("Captured ‚Äî tap Analyze.", true);
      logEvent('camera_capture', { size: blob.size });
    };
  }

  /* =========================
     PREVIEW HELPERS
  ==========================*/
  function previewReplaceWithImage(url){
    const img=document.createElement("img");
    img.id="previewImg"; img.alt="preview"; img.src=url;
    previewReplaceWithNode(img);
  }
  function previewReplaceWithNode(node){
    const old=el.preview.querySelector("img,video");
    if(old) old.replaceWith(node); else el.preview.prepend(node);
  }

  /* =========================
     ANALYZE
  ==========================*/
  el.btnAnalyze.onclick = async ()=>{
    if(!el.preview.style.display || el.preview.style.display==='none'){
      showTip("Upload or capture a photo first.", true); return;
    }
    const blob = el.file._capturedBlob;
    const fileEl = el.file.files && el.file.files[0];
    if(!blob && !fileEl){ showTip("No image found.", true); return; }

    STATE.analyzing = true;
    el.preview.classList.add('glow-on');
    el.wheel.style.display='flex'; el.wheelText.textContent = "Analyzing‚Ä¶";

    const formData=new FormData();
    if(blob) formData.append("file",blob,"capture.jpg"); else formData.append("file",fileEl);

    try{
      speak("Analyzing image.", 2);
      logEvent('analyze_start', {});
      const resp = await fetch(`${API}/analyze-image`, { method:"POST", body:formData });
      const data = await resp.json();
      const summary = data.summary || "Analysis complete.";
      STATE.lastSummary = summary;
      logEvent('analyze_result', { summary });

      // Speak the summary and show tips (no chat boxes)
      speak(summary, 2);
      showAnalysisTips(summary);

      el.hudTabs.style.display='flex';
      el.btnExport.classList.remove('hidden');
      el.dashHint.style.opacity=.6;

      // First full demo flag (FREE)
      if(!STATE.demoUsed){
        localStorage.setItem('herohud_demo_analysis_used','1');
        STATE.demoUsed = true;
      }
    }catch(e){
      showTip("‚ùå Analysis failed.", true);
      logEvent('analyze_error', { msg: String(e) });
      speak("Analysis failed. Please try again.", 2);
    } finally {
      el.wheel.style.display='none';
      el.preview.classList.remove('glow-on');
      STATE.analyzing = false;
    }
  };

  /* =========================
     EXPORT (PRO PAYWALL)
  ==========================*/
  el.btnExport.onclick = ()=>{
    if(!STATE.proUnlocked){
      speak("Pro Sales Insight required to export a client-ready report.", 2);
      openPaywall("Pro Sales Insight Required","Choose single $39/report or $89/month unlimited.");
      return;
    }
    triggerExport();
  };

  async function triggerExport(){
    try{
      logEvent('export_start', {});
      speak("Generating your professional report.", 2);
      // Compile silent log + lastSummary
      const tipsTxt=[...document.querySelectorAll('.tip')].map(e=>e.textContent.trim()).join("\n");
      const payload = {
        summary: STATE.lastSummary || "",
        tips: tipsTxt || "",
        logs: STATE.logs
      };
      const resp = await fetch(`${API}/export`, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload) });
      if(resp.ok && resp.headers.get('content-type')?.includes('application/pdf')){
        const blob = await resp.blob();
        const a=document.createElement("a"); a.href=URL.createObjectURL(blob); a.download="herohud_pro_report.pdf"; a.click();
      }else{
        const fallback = `HeroHUD Pro Report\n\nSummary:\n${payload.summary}\n\nTips:\n${payload.tips}\n\n(Voice log available via Garage ‚Üí Download Logs)`;
        downloadText("herohud_pro_report.txt", fallback);
      }
      logEvent('export_done', {});
      speak("Report ready.", 2);
    }catch(e){
      logEvent('export_error', { msg:String(e) });
      showTip("Export failed. Try again.", true);
      speak("Export failed. Please try again.", 2);
    }
  }

  /* =========================
     FILE UPLOAD
  ==========================*/
  el.btnUpload.onclick = ()=> { if(!enforceUploadGate()) return; el.file.click(); };
  el.file.onchange=()=>{
    const f=el.file.files[0]; if(!f) return;
    const url=URL.createObjectURL(f);
    previewReplaceWithImage(url);
    el.preview.style.display='block';
    el.dashHint.style.opacity=.25;
    bumpUploads();
    showTip("Photo loaded ‚Äî tap Analyze.", true);
    logEvent('upload', { name:f.name, size:f.size });
  };

  /* =========================
     CAMERA WIRE
  ==========================*/
  el.btnCamera.onclick = openCamera;

  /* =========================
     GARAGE WIRE
  ==========================*/
  el.garageTrigger.onclick = openGarage;
  el.garageCloseBtn.onclick = closeGarage;

  // Access+
  el.btnAccessMonthly.onclick = ()=>{
    localStorage.setItem('herohud_access_unlocked','1');
    STATE.accessUnlocked = true;
    speak("Access Plus confirmed. Unlimited uploads and analyses are live.", 2);
  };

  // Pro Sales Insight activation
  el.btnProActivate.onclick = ()=>{
    const choice = document.querySelector('input[name="proMode"]:checked')?.value || 'single';
    STATE.proMode = choice;
    localStorage.setItem('herohud_pro_unlocked','1');
    STATE.proUnlocked = true;
    if(choice==='single'){
      speak("Single report mode selected. Pro Sales Insight ready at thirty-nine dollars per export.", 2);
    } else {
      speak("Unlimited Pro Sales Insight activated at eighty-nine dollars per month.", 2);
    }
  };

  // Sales U
  el.btnSalesU.onclick = ()=>{
    speak("Sales University engaged. You‚Äôre entering a one-week sprint built from elite systems. I‚Äôll guide you through each stage.", 2);
  };
  el.btnSalesUDemo.onclick = ()=>{
    localStorage.setItem('herohud_salesu_demo','1');
    STATE.salesUDemo = true;
    speak("One additional analysis demo has been granted via Sales University. Use it to practice a real job.", 2);
  };

  // Hero Complete
  el.btnHeroComplete.onclick = ()=>{
    localStorage.setItem('herohud_access_unlocked','1');
    localStorage.setItem('herohud_pro_unlocked','1');
    STATE.accessUnlocked = true; STATE.proUnlocked = true;
    speak("Hero Complete activated. All systems at full capacity ‚Äî welcome to command mode.", 2);
  };

  // Founder lifetime
  el.btnFounderLifetime.onclick = ()=>{
    speak("Founder mode queued. We‚Äôll finalize your permanent build and branding shortly.", 2);
  };

  // Founder Deck
  el.btnFounderDeck.onclick = async ()=>{
    try{
      const resp = await fetch(`${API}/founder-report`, { method: 'POST' });
      if(!resp.ok) throw new Error('Founder report failed');
      const blob = await resp.blob();
      const a=document.createElement("a");
      a.href=URL.createObjectURL(blob);
      a.download = "HeroHUD_FoundersDeck.pdf";
      a.click();
      speak("Founder‚Äôs Deck generated.", 2);
    }catch(e){
      showTip("Founder‚Äôs Deck generation failed.", true);
      speak("Founder‚Äôs Deck generation failed. Please try again.", 2);
    }
  };

  // Logs download
  el.btnDownloadLogs.onclick = ()=>{
    const text = JSON.stringify(STATE.logs, null, 2);
    downloadText("herohud_logs.txt", text);
    speak("Log archive downloaded.", 2);
  };

  /* =========================
     PAYWALL BUTTONS
  ==========================*/
  el.btnPaywallClose.onclick = closePaywall;
  el.btnProOnce.onclick = ()=>{
    localStorage.setItem('herohud_pro_unlocked','1');
    STATE.proUnlocked = true;
    STATE.proMode = 'single';
    speak("Single report mode confirmed for Pro Sales Insight.", 2);
    closePaywall();
    triggerExport();
  };
  el.btnProMonthly.onclick = ()=>{
    localStorage.setItem('herohud_pro_unlocked','1');
    localStorage.setItem('herohud_access_unlocked','1'); // nice perk if desired
    STATE.proUnlocked = true; STATE.accessUnlocked = true; STATE.proMode = 'unlimited';
    speak("Unlimited Pro Sales Insight and Access Plus are now active.", 2);
    closePaywall();
  };

  /* =========================
     INIT
  ==========================*/
  window.addEventListener('load', () => {
    // Preload voices (some browsers require this)
    window.speechSynthesis.getVoices();
    boot();
  });

  /* =========================
     SMALL HELPERS
  ==========================*/
  function wait(ms){ return new Promise(r=>setTimeout(r,ms)) }

})();
</script>
</body>
</html>
